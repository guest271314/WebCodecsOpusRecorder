<!DOCTYPE html>

<html>
  <head>
    <title>WebCodecs Opus Recorder/Media Source Extensions Opus EncodedAudioChunk, WAV Player</title>
    <style>
      input,
      audio {
        position: relative;
        display: block;
      }
    </style>
  </head>

  <body>
    <p>WebCodecs Opus Recorder and Player</p>
    <button id="record">Record</button><button id="stop">Stop</button><br />
    <label for="playback-type">Playback type</label>
    <select id="playback-type">
      <option selected value="mediaSource">MediaSource</option>
      <option value="wav">WAV</option>
    </select>
    <input type="file" accept=".webcodecs" id="file" />
    <script type="module">
      import {
        WebCodecsOpusRecorder,
        WebCodecsOpusPlayer,
        WavAudioEncoder,
      } from './WebCodecsOpusRecorder.js';
      
      let webcodecsOpusRecorder, mediaRecorder, stream, track;
      
      document.getElementById('record').onclick = async () => {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        [track] = stream.getAudioTracks();
        webcodecsOpusRecorder = new WebCodecsOpusRecorder(track);
        webcodecsOpusRecorder.start();      
      };
      
      document.getElementById('stop').onclick = () => {
        webcodecsOpusRecorder.stop();
      };

      document.getElementById('file').onchange = async ({
        target: {
          files: [file],
        },
      }) => {
        if (file) {
          const webcodecsOpusPlayer = new WebCodecsOpusPlayer(
            await file.arrayBuffer(),
            { type: document.getElementById('playback-type').value }
          );
          await webcodecsOpusPlayer.play();
        }
      };
    </script>
  </body>
</html>
